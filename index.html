<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Análise de Volumetria</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    .summary { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Análise de Volumetria</h2>
  <input type="file" id="fileInput" multiple accept=".xlsx" />
  <div id="output"></div>

  <script>
    const loginToName = {
      "n0238475": "MARLEY MARQUES RIBEIRO",
      "n5923221": "KELLY PINHEIRO LIRA",
      "f160641": "JENNIFER MARIA ANDRADE SANTOS",
      "n5772086": "THIAGO PEREIRA DA SILVA",
      "n0239871": "LEONARDO FERREIRA LIMA DE ALMEIDA",
      "n5577565": "MARISTELLA MARCIA DOS SANTOS",
      "n5737414": "SANDRO DA SILVA CARVALHO",
      "n5972428": "CRISTIANE HERMOGENES DA SILVA",
      "n6173055": "JEFFERSON LUIS GONÇALVES COITINHO",
      "n5932090": "EVILÁZIO ANDRÉ DE MAGALHÃES GOMES PEREIRA",
      "n0255801": "ELBERTON ANICETO HENRIQUE",
      "n4014011": "ALAN MARINHO DIAS",
      "n5923996": "JULIO CESAR SANTOS SOARES"
    };

    document.getElementById('fileInput').addEventListener('change', async function (e) {
      const files = e.target.files;
      const volumes = {};

      for (let file of files) {
        const data = await file.arrayBuffer();
        const workbook = XLSX.read(data, { type: 'array' });

        workbook.SheetNames.forEach(sheetName => {
          const sheet = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);
          
          sheet.forEach(row => {
            const rawLogin = String(row['LOGIN'] || '').toLowerCase().trim();
            const volume = Number(row['VOLUME'] || 0);
            if (!rawLogin) return;
            if (!volumes[rawLogin]) volumes[rawLogin] = 0;
            volumes[rawLogin] += volume;
          });
        });
      }

      const output = document.getElementById('output');
      output.innerHTML = '';

      const table = document.createElement('table');
      const header = table.insertRow();
      ['Login', 'Nome', 'Total de Volume'].forEach(text => {
        const th = document.createElement('th');
        th.textContent = text;
        header.appendChild(th);
      });

      const sortedLogins = Object.keys(volumes).sort((a, b) => volumes[b] - volumes[a]);

      let total = 0, min = Infinity, max = -Infinity;

      sortedLogins.forEach(login => {
        const volume = volumes[login];
        total += volume;
        if (volume > max) max = volume;
        if (volume < min) min = volume;

        const row = table.insertRow();
        row.insertCell().textContent = login.toUpperCase();
        row.insertCell().textContent = loginToName[login] || 'NOME DESCONHECIDO';
        row.insertCell().textContent = volume;
      });

      output.appendChild(table);

      const summary = document.createElement('div');
      summary.className = 'summary';
      summary.innerHTML = `
        Total Geral: ${total}<br/>
        Média: ${(total / sortedLogins.length).toFixed(2)}<br/>
        Máximo: ${max}<br/>
        Mínimo: ${min}
      `;
      output.appendChild(summary);
    });
  </script>
</body>
</html>
