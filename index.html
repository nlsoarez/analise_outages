<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Dashboard de Outages - Claro Brasil</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f9f9f9;
            color: #333;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #E60012;
            color: #fff;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        h2 {
            color: #E60012;
            border-bottom: 2px solid #E60012;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        .card {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            padding: 6px 0;
            border-bottom: 1px solid #f1f1f1;
        }
        .chart-container {
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Dashboard de Outages - Claro Brasil</h1>
    </header>
    <div class="container">
        <input type="file" id="fileInput" multiple>

        <div class="card">
            <h2>Volume Geral por Mês</h2>
            <ul id="volumeMes"></ul>
        </div>

        <div class="card">
            <h2>Volume por Analista</h2>
            <ul id="volumeAnalista"></ul>
        </div>

        <div class="card">
            <h2>Clusters com Maior Atuação</h2>
            <ul id="volumeCluster"></ul>
        </div>

        <div class="card">
            <h2>Tecnologia com Maior Atuação</h2>
            <ul id="volumeTecnologia"></ul>
        </div>

        <div class="card">
            <h2>Dias de Maior e Menor Volume por Mês</h2>
            <ul id="volumeDias"></ul>
        </div>

        <div class="chart-container">
            <canvas id="chartAnalistas"></canvas>
        </div>
    </div>

    <script>
        const analistasFoco = {
            'N0238475': 'MARLEY MARQUES RIBEIRO',
            'N5923221': 'KELLY PINHEIRO LIRA',
            'F160641': 'JENNIFER MARIA ANDRADE SANTOS',
            'N5772086': 'THIAGO PEREIRA DA SILVA',
            'N0239871': 'LEONARDO FERREIRA LIMA DE ALMEIDA',
            'N5577565': 'MARISTELLA MARCIA DOS SANTOS',
            'N5737414': 'SANDRO DA SILVA CARVALHO',
            'N5972428': 'CRISTIANE HERMOGENES DA SILVA',
            'N6173055': 'JEFFERSON LUIS GONÇALVES COITINHO',
            'N5932090': 'EVILÁZIO ANDRÉ DE MAGALHÃES GOMES PEREIRA',
            'N0255801': 'ELBERTON ANICETO HENRIQUE',
            'N4014011': 'ALAN MARINHO DIAS'
        };

        document.getElementById('fileInput').addEventListener('change', handleFiles, false);

        function handleFiles(event) {
            const files = event.target.files;
            const promises = Array.from(files).map(readExcel);
            Promise.all(promises).then(dataArrays => {
                const allData = dataArrays.flat();
                processData(allData);
            });
        }

        function readExcel(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const sheet = workbook.Sheets[workbook.SheetNames[0]];
                    const json = XLSX.utils.sheet_to_json(sheet);
                    resolve(json);
                };
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }

        function processData(data) {
            const volumeMes = {};
            const volumeAnalista = {};
            const volumeCluster = {};
            const volumeTecnologia = {};
            const diasPorMes = {};

            data.forEach(row => {
                const dataHora = new Date(row['DIA / HORA']);
                const mes = dataHora.getMonth() + 1;
                const dia = dataHora.getDate();
                const login = (row['LOGIN'] || '').toUpperCase();
                const cluster = row['CLUSTER'] || 'Indefinido';
                const tecnologia = row['TECNOLOGIA'] || 'Indefinida';

                volumeMes[mes] = (volumeMes[mes] || 0) + 1;

                volumeAnalista[login] = (volumeAnalista[login] || 0) + 1;
                volumeCluster[cluster] = (volumeCluster[cluster] || 0) + 1;
                volumeTecnologia[tecnologia] = (volumeTecnologia[tecnologia] || 0) + 1;

                diasPorMes[mes] = diasPorMes[mes] || {};
                diasPorMes[mes][dia] = (diasPorMes[mes][dia] || 0) + 1;
            });

            renderList('volumeMes', volumeMes, 'Mês ');
            renderAnalistas('volumeAnalista', volumeAnalista, analistasFoco);
            renderList('volumeCluster', volumeCluster);
            renderList('volumeTecnologia', volumeTecnologia);
            renderDias('volumeDias', diasPorMes);

            renderChart(volumeAnalista, analistasFoco);
        }

        function renderList(elementId, dataObj, prefix = '') {
            const ul = document.getElementById(elementId);
            ul.innerHTML = '';
            Object.keys(dataObj).sort().forEach(key => {
                const li = document.createElement('li');
                li.textContent = `${prefix}${key}: ${dataObj[key]}`;
                ul.appendChild(li);
            });
        }

        function renderAnalistas(elementId, dataObj, focus) {
            const ul = document.getElementById(elementId);
            ul.innerHTML = '';
            let outros = 0;

            Object.keys(focus).forEach(login => {
                const nome = focus[login];
                const count = dataObj[login] || 0;
                const li = document.createElement('li');
                li.textContent = `${nome}: ${count}`;
                ul.appendChild(li);
            });

            Object.keys(dataObj).forEach(login => {
                if (!focus[login]) {
                    outros += dataObj[login];
                }
            });

            const li = document.createElement('li');
            li.textContent = `OUTROS: ${outros}`;
            ul.appendChild(li);
        }

        function renderDias(elementId, diasPorMes) {
            const ul = document.getElementById(elementId);
            ul.innerHTML = '';
            Object.keys(diasPorMes).forEach(mes => {
                const dias = diasPorMes[mes];
                const sorted = Object.entries(dias).sort((a,b) => b[1]-a[1]);
                const maior = sorted[0];
                const menor = sorted[sorted.length -1];
                const li = document.createElement('li');
                li.textContent = `Mês ${mes}: Maior volume dia ${maior[0]} (${maior[1]}) | Menor volume dia ${menor[0]} (${menor[1]})`;
                ul.appendChild(li);
            });
        }

        function renderChart(analistas, focus) {
            const ctx = document.getElementById('chartAnalistas').getContext('2d');
            const focusAnalistas = Object.keys(focus);
            const labels = focusAnalistas.map(login => focus[login]).concat(['OUTROS']);

            const data = focusAnalistas.map(login => analistas[login] || 0);
            const outros = Object.keys(analistas).reduce((sum, login) => {
                return focusAnalistas.includes(login) ? sum : sum + analistas[login];
            }, 0);
            data.push(outros);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Volume por Analista',
                        data: data,
                        backgroundColor: '#E60012'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }
    </script>
</body>
</html>
