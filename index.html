<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Banco de Horas | Controle Mensal</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary: #4361ee;
      --primary-light: #4895ef;
      --secondary: #3f37c9;
      --danger: #f72585;
      --warning: #f77f00;
      --success: #4cc9f0;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --white: #ffffff;
      --excesso: #ff9999;
      --normal: #b3e6b3;
      --negativo: #ffcccc;
      --violacao: #ff6666;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f5f7fa;
      color: var(--dark);
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--primary-light);
    }

    h1 {
      color: var(--primary);
      font-weight: 700;
      font-size: 28px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-icon {
      font-size: 32px;
      color: var(--primary);
    }

    .card {
      background-color: var(--white);
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      padding: 25px;
      margin-bottom: 25px;
    }

    .card-title {
      font-size: 20px;
      color: var(--primary);
      margin-bottom: 20px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-title i {
      font-size: 24px;
    }

    .legenda {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 20px;
    }

    .legenda-item {
      display: flex;
      align-items: center;
      font-size: 14px;
    }

    .legenda-cor {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      margin-right: 8px;
      border: 1px solid rgba(0,0,0,0.1);
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark);
    }

    select, input {
      width: 100%;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.3s;
    }

    select:focus, input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 20px;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      border: none;
      font-size: 14px;
      gap: 8px;
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--secondary);
    }

    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }

    .btn-outline:hover {
      background-color: var(--primary);
      color: white;
    }

    .btn-danger {
      background-color: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background-color: #d3166d;
    }

    .btn-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .table-container {
      overflow-x: auto;
      margin-top: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px;
    }

    th, td {
      padding: 12px 15px;
      text-align: center;
      border-bottom: 1px solid #e9ecef;
    }

    th {
      background-color: var(--primary);
      color: white;
      font-weight: 500;
      position: sticky;
      top: 0;
    }

    tr:hover {
      background-color: rgba(67, 97, 238, 0.05);
    }

    .violacao {
      background-color: var(--violacao);
      color: white;
      font-weight: bold;
    }

    .excesso {
      background-color: var(--excesso);
    }

    .normal {
      background-color: var(--normal);
    }

    .saldo-negativo {
      background-color: var(--negativo);
    }

    .total {
      font-weight: bold;
      background-color: rgba(108, 117, 125, 0.1);
    }

    .sem-dados {
      color: var(--gray);
      font-style: italic;
    }

    .status {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-ok {
      background-color: rgba(76, 201, 240, 0.2);
      color: var(--success);
    }

    .status-violacao {
      background-color: rgba(247, 37, 133, 0.2);
      color: var(--danger);
    }

    .filtros {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .filtro-group {
      flex: 1;
      min-width: 250px;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .modal.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background-color: white;
      border-radius: 10px;
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transform: translateY(-20px);
      transition: all 0.3s;
    }

    .modal.active .modal-content {
      transform: translateY(0);
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 500;
      color: var(--primary);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--gray);
    }

    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      padding: 20px;
      border-top: 1px solid #e9ecef;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    /* Responsividade */
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .btn-group {
        width: 100%;
      }
      
      .btn {
        flex: 1;
        min-width: 120px;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <div class="logo">
      <span class="logo-icon"><i class="fas fa-clock"></i></span>
      <h1>Banco de Horas</h1>
    </div>
    <div class="btn-group">
      <button class="btn btn-outline" onclick="exportarDados()">
        <i class="fas fa-file-export"></i> Exportar
      </button>
      <button class="btn btn-outline" onclick="importarDados()">
        <i class="fas fa-file-import"></i> Importar
      </button>
      <button class="btn btn-danger" onclick="limparDados()">
        <i class="fas fa-trash-alt"></i> Limpar
      </button>
    </div>
  </header>

  <div class="card">
    <h2 class="card-title"><i class="fas fa-info-circle"></i> Legenda</h2>
    <div class="legenda">
      <div class="legenda-item">
        <span class="legenda-cor" style="background-color: var(--violacao);"></span>
        Violação: 3+ meses consecutivos >10h
      </div>
      <div class="legenda-item">
        <span class="legenda-cor" style="background-color: var(--excesso);"></span>
        Saldo >10h
      </div>
      <div class="legenda-item">
        <span class="legenda-cor" style="background-color: var(--normal);"></span>
        Saldo entre 0-10h
      </div>
      <div class="legenda-item">
        <span class="legenda-cor" style="background-color: var(--negativo);"></span>
        Saldo negativo
      </div>
    </div>
  </div>

  <div class="card">
    <h2 class="card-title"><i class="fas fa-edit"></i> Controle de Dados</h2>
    <div class="form-group">
      <label for="selecionarMes">Selecione o mês para edição:</label>
      <select id="selecionarMes">
        <option value="maio">Maio</option>
        <option value="junho">Junho</option>
        <option value="julho">Julho</option>
        <option value="agosto">Agosto</option>
        <option value="setembro">Setembro</option>
        <option value="outubro">Outubro</option>
        <option value="novembro">Novembro</option>
        <option value="dezembro">Dezembro</option>
      </select>
    </div>
    <button class="btn btn-primary" onclick="editarMes()">
      <i class="fas fa-pencil-alt"></i> Editar Mês
    </button>
  </div>

  <div class="card">
    <h2 class="card-title"><i class="fas fa-filter"></i> Filtros</h2>
    <div class="filtros">
      <div class="filtro-group">
        <label for="filtroNome">Buscar por nome:</label>
        <input type="text" id="filtroNome" onkeyup="filtrarTabela()" placeholder="Digite o nome...">
      </div>
      <div class="filtro-group">
        <label>Filtros avançados:</label>
        <div class="checkbox-group">
          <input type="checkbox" id="filtroViolacao" onchange="filtrarTabela()">
          <label for="filtroViolacao">Mostrar apenas violações</label>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <h2 class="card-title"><i class="fas fa-table"></i> Dados dos Analistas</h2>
    <div class="table-container">
      <table id="tabelaHoras">
        <thead>
          <tr>
            <th>Analista</th>
            <!-- Meses serão adicionados dinamicamente -->
            <th>Total</th>
            <th>Meses >10h</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <!-- Dados serão inseridos via JavaScript -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal" id="modalEdicao">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title" id="modalTitulo">Editar Mês</h3>
      <button class="modal-close" onclick="fecharModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Analista</th>
              <th>Horas</th>
            </tr>
          </thead>
          <tbody id="modalBody">
          </tbody>
        </table>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="fecharModal()">
        <i class="fas fa-times"></i> Cancelar
      </button>
      <button class="btn btn-primary" id="salvarModal">
        <i class="fas fa-save"></i> Salvar
      </button>
    </div>
  </div>
</div>

<script>
  // Estrutura de dados inicial
  let bancoHoras = {
    meses: [], // Ordem dos meses adicionados
    funcionarios: [] // Dados dos funcionários
  };

  // Nomes dos funcionários
  const nomesFuncionarios = [
    "LEANDRO GONÇALVES DE CARVALHO",
    "BRUNO COSTA BUCARD",
    "IGOR MARCELINO DE MARINS",
    "GABRIELA TAVARES DA SILVA",
    "MAGNO FERRAREZ DE MORAIS",
    "DANIEL MARCELO FELISBERTO OLIVEIRA",
    "FERNANDA MESQUITA DE FREITAS",
    "ROBERTO SILVA DO NASCIMENTO",
    "RODRIGO PIRES BERNARDINO",
    "SUELLEN HERNANDEZ DA SILVA",
    "MONICA DA SILVA RODRIGUES",
    "MARLEY MARQUES RIBEIRO",
    "KELLY PINHEIRO LIRA",
    "JENNIFER MARIA ANDRADE SANTOS",
    "THIAGO PEREIRA DA SILVA",
    "LEONARDO FERREIRA LIMA DE ALMEIDA",
    "MARISTELLA MARCIA DOS SANTOS",
    "SANDRO DA SILVA CARVALHO",
    "CRISTIANE HERMOGENES DA SILVA",
    "JEFFERSON LUIS GONÇALVES COITINHO",
    "EVILÁZIO ANDRÉ DE MAGALHÃES GOMES PEREIRA",
    "ELBERTON ANICETO HENRIQUE",
    "ALAN MARINHO DIAS",
    "JULIO CESAR SANTOS SOARES",
    "CARLOS EDUARDO BARRETO DE ABREU",
    "ROSANA RIEGER MATOS",
    "THIAGO DE SOUZA INACIO"
  ];

  // Dados iniciais de Maio
  const dadosIniciaisMaio = {
    "LEANDRO GONÇALVES DE CARVALHO": -4.22,
    "BRUNO COSTA BUCARD": 4.59,
    "IGOR MARCELINO DE MARINS": -0.16,
    "GABRIELA TAVARES DA SILVA": -10.34,
    "MAGNO FERRAREZ DE MORAIS": null,
    "DANIEL MARCELO FELISBERTO OLIVEIRA": 8.02,
    "FERNANDA MESQUITA DE FREITAS": 2.42,
    "ROBERTO SILVA DO NASCIMENTO": 2.04,
    "RODRIGO PIRES BERNARDINO": 0.04,
    "SUELLEN HERNANDEZ DA SILVA": 10.08,
    "MONICA DA SILVA RODRIGUES": 10.57,
    "MARLEY MARQUES RIBEIRO": 11.51,
    "KELLY PINHEIRO LIRA": 1.56,
    "JENNIFER MARIA ANDRADE SANTOS": 6.08,
    "THIAGO PEREIRA DA SILVA": 9.39,
    "LEONARDO FERREIRA LIMA DE ALMEIDA": 9.27,
    "MARISTELLA MARCIA DOS SANTOS": 1.55,
    "SANDRO DA SILVA CARVALHO": -6.49,
    "CRISTIANE HERMOGENES DA SILVA": 9.55,
    "JEFFERSON LUIS GONÇALVES COITINHO": 14.36,
    "EVILÁZIO ANDRÉ DE MAGALHÃES GOMES PEREIRA": -59,
    "ELBERTON ANICETO HENRIQUE": 8.35,
    "ALAN MARINHO DIAS": 11.45,
    "JULIO CESAR SANTOS SOARES": 13.12,
    "CARLOS EDUARDO BARRETO DE ABREU": 7.07,
    "ROSANA RIEGER MATOS": 10.50,
    "THIAGO DE SOUZA INACIO": 8.40
  };

  // Nomes dos meses para exibição
  const mesesNomes = {
    "maio": "Maio",
    "junho": "Junho",
    "julho": "Julho",
    "agosto": "Agosto",
    "setembro": "Setembro",
    "outubro": "Outubro",
    "novembro": "Novembro",
    "dezembro": "Dezembro"
  };

  // Carregar dados salvos ao iniciar
  document.addEventListener('DOMContentLoaded', function() {
    carregarDados();
    inicializarTabela();
  });

  // Carrega dados do localStorage ou inicializa com Maio
  function carregarDados() {
    const dadosSalvos = localStorage.getItem('bancoHoras');
    if (dadosSalvos) {
      bancoHoras = JSON.parse(dadosSalvos);
    } else {
      // Inicializar com dados de Maio
      bancoHoras.meses = ["maio"];
      bancoHoras.funcionarios = nomesFuncionarios.map(nome => {
        return {
          nome: nome,
          maio: dadosIniciaisMaio[nome]
        };
      });
      salvarDados();
    }
  }

  // Salva dados no localStorage
  function salvarDados() {
    localStorage.setItem('bancoHoras', JSON.stringify(bancoHoras));
  }

  // Inicializa a tabela com os dados atuais
  function inicializarTabela() {
    const tbody = document.querySelector("#tabelaHoras tbody");
    tbody.innerHTML = "";

    // Configurar cabeçalho com meses
    const thead = document.querySelector("#tabelaHoras thead tr");
    thead.innerHTML = "<th>Analista</th>";
    
    bancoHoras.meses.forEach(mesId => {
      thead.innerHTML += `<th>${mesesNomes[mesId]}</th>`;
    });
    
    thead.innerHTML += "<th>Total</th><th>Meses >10h</th><th>Status</th>";

    // Adicionar linhas para cada funcionário
    bancoHoras.funcionarios.forEach(funcionario => {
      const row = document.createElement("tr");
      
      // Nome do funcionário
      const nomeCell = document.createElement("td");
      nomeCell.textContent = funcionario.nome;
      row.appendChild(nomeCell);

      // Células para cada mês
      bancoHoras.meses.forEach(mesId => {
        const cell = document.createElement("td");
        const valor = funcionario[mesId];
        
        if (valor !== null && valor !== undefined) {
          cell.textContent = valor.toFixed(2);
          aplicarEstiloCelula(cell, valor);
        } else {
          cell.textContent = "";
          cell.classList.add("sem-dados");
        }
        
        row.appendChild(cell);
      });

      // Célula de total
      const totalCell = document.createElement("td");
      totalCell.classList.add("total");
      row.appendChild(totalCell);

      // Célula de meses com excesso
      const excessoCell = document.createElement("td");
      row.appendChild(excessoCell);

      // Célula de status
      const statusCell = document.createElement("td");
      row.appendChild(statusCell);

      tbody.appendChild(row);
    });

    atualizarTotais();
    verificarViolacoes();
  }

  // Aplica o estilo correto para cada célula baseado no valor
  function aplicarEstiloCelula(cell, valor) {
    // Limpar classes anteriores
    cell.className = '';
    
    if (valor === null || valor === undefined) {
      cell.classList.add("sem-dados");
      return;
    }
    
    if (valor > 10) {
      cell.classList.add("excesso");
    } else if (valor >= 0) {
      cell.classList.add("normal");
    } else {
      cell.classList.add("saldo-negativo");
    }
  }

  // Abre modal para editar um mês específico
  function editarMes() {
    const mesId = document.getElementById("selecionarMes").value;
    const mesNome = mesesNomes[mesId];
    
    // Verificar se o mês já existe, se não, adicionar
    if (!bancoHoras.meses.includes(mesId)) {
      bancoHoras.meses.push(mesId);
      
      // Adicionar propriedade do mês para cada funcionário
      bancoHoras.funcionarios.forEach(func => {
        func[mesId] = null;
      });
      
      salvarDados();
    }
    
    // Atualizar título do modal
    document.getElementById("modalTitulo").textContent = `Editar ${mesNome}`;
    
    // Preencher tabela no modal
    const modalBody = document.getElementById("modalBody");
    modalBody.innerHTML = "";
    
    bancoHoras.funcionarios.forEach(funcionario => {
      const row = document.createElement("tr");
      
      const nomeCell = document.createElement("td");
      nomeCell.textContent = funcionario.nome;
      row.appendChild(nomeCell);
      
      const horasCell = document.createElement("td");
      const input = document.createElement("input");
      input.type = "number";
      input.step = "0.01";
      input.value = funcionario[mesId] !== null && funcionario[mesId] !== undefined ? funcionario[mesId] : "";
      input.style.width = "100%";
      input.style.padding = "8px";
      input.style.border = "1px solid #ddd";
      input.style.borderRadius = "4px";
      horasCell.appendChild(input);
      row.appendChild(horasCell);
      
      modalBody.appendChild(row);
    });
    
    // Configurar evento de salvar
    document.getElementById("salvarModal").onclick = function() {
      salvarDadosMes(mesId);
    };
    
    // Mostrar modal
    document.getElementById("modalEdicao").classList.add("active");
  }

  // Salva os dados do mês editado
  function salvarDadosMes(mesId) {
    const inputs = document.querySelectorAll("#modalBody input");
    
    inputs.forEach((input, index) => {
      const valor = input.value.trim() === "" ? null : parseFloat(input.value);
      bancoHoras.funcionarios[index][mesId] = valor;
    });
    
    salvarDados();
    fecharModal();
    inicializarTabela();
  }

  // Fecha o modal
  function fecharModal() {
    document.getElementById("modalEdicao").classList.remove("active");
  }

  // Atualiza totais e contagem de meses com excesso
  function atualizarTotais() {
    const rows = document.querySelectorAll("#tabelaHoras tbody tr");

    rows.forEach((row, index) => {
      let total = 0;
      let mesesExcesso = 0;

      // Calcular total e meses com excesso
      for (let i = 1; i < row.cells.length - 3; i++) {
        const valor = parseFloat(row.cells[i].textContent) || 0;
        total += valor;
        
        if (valor > 10) {
          mesesExcesso++;
        }
      }

      // Atualizar células de total e excesso
      row.cells[row.cells.length - 3].textContent = total.toFixed(2);
      row.cells[row.cells.length - 2].textContent = mesesExcesso;
    });
  }

  // Verifica violações (3+ meses consecutivos >10h)
  function verificarViolacoes() {
    const rows = document.querySelectorAll("#tabelaHoras tbody tr");

    rows.forEach((row, index) => {
      let contagem = 0;
      let violou = false;

      // Verificar células de meses (ignorando nome, total, meses >10h e status)
      for (let i = 1; i < row.cells.length - 3; i++) {
        const celula = row.cells[i];
        const valor = parseFloat(celula.textContent) || 0;

        if (valor > 10) {
          contagem++;
          
          if (contagem >= 3) {
            violou = true;
          }
        } else {
          contagem = 0;
        }
      }

      // Atualizar status
      const statusCell = row.cells[row.cells.length - 1];
      statusCell.textContent = violou ? "Violação" : "OK";
      statusCell.className = violou ? "status status-violacao" : "status status-ok";

      // Destacar linha se violou
      if (violou) {
        row.classList.add("violacao");
      } else {
        row.classList.remove("violacao");
      }
    });
  }

  // Filtra a tabela por nome e/ou violações
  function filtrarTabela() {
    const filtroNome = document.getElementById("filtroNome").value.toUpperCase();
    const filtroViolacao = document.getElementById("filtroViolacao").checked;
    const rows = document.querySelectorAll("#tabelaHoras tbody tr");

    rows.forEach(row => {
      const nome = row.cells[0].textContent.toUpperCase();
      const violacao = row.classList.contains("violacao");
      
      const mostraNome = nome.includes(filtroNome);
      const mostraViolacao = !filtroViolacao || violacao;
      
      row.style.display = (mostraNome && mostraViolacao) ? "" : "none";
    });
  }

  // Exporta dados para JSON
  function exportarDados() {
    const dadosParaExportar = bancoHoras;
    
    const blob = new Blob([JSON.stringify(dadosParaExportar, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = 'banco_de_horas.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // Importa dados de JSON
  function importarDados() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      
      reader.onload = event => {
        try {
          const dados = JSON.parse(event.target.result);
          bancoHoras = dados;
          salvarDados();
          inicializarTabela();
          alert('Dados importados com sucesso!');
        } catch (error) {
          alert('Erro ao importar dados: ' + error.message);
        }
      };
      
      reader.readAsText(file);
    };
    
    input.click();
  }

  // Limpa todos os dados
  function limparDados() {
    if (confirm('Tem certeza que deseja limpar TODOS os dados? Esta ação não pode ser desfeita.')) {
      localStorage.removeItem('bancoHoras');
      location.reload();
    }
  }
</script>
</body>
</html>
